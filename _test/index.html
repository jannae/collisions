<!DOCTYPE html>

<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!--link rel="apple-touch-icon" href="apple-touch-icon.png" /-->
	<meta name="apple-touch-fullscreen" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>Collide.</title>

    <link rel="stylesheet" type="text/css" href="./_css/reset.css">
    <link rel="stylesheet" type="text/css" href="./_css/main.css">
    
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    <script type="text/javascript" language="javascript" src="./_js/processing-1.3.6.min.js"></script>
    
	<script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
    
        var socket = io.connect();
        
        var x, y, z; // Position Variables for 
	    var vx, vy, vz; // Speed - Velocity
	    var ax, ay, az; // Acceleration
	    var ai; // data reporting interval (event.interval)
	    var arAlpha, arBeta, arGamma; // rotation acceleration angles
	    var delay = 100;
	    var vMultiplier = 0.01;
	    var alpha = 0;
	    var beta = 0;
	    var gamma = 0;
	    var stabilize = 0;
        var delay = 100;
        //code for random rgb colors
        var r = random(0,255);
        var g = random(0,255);
        var b = random(0,255);

        var iosData = {};
	    	
        $(document).ready(function() {
            $('#broadcast').hide();
            
            $('#sendname').click( function() {
                $('#signin').hide();
                $('#broadcast').show();
                
            	var name = $('#name').val();
    			$('#name').val('');
                
                //userdata = 'rgb('+r+','+g+','+b+')';
                userdata = {'r': r, 'g':g, 'b':b};
                                
                /*//code for random hex colors
                userdata = ((1<<24)*Math.random()|0).toString(16);
                $('#header h2',{html:name}).css('color','#'+userdata).appendTo('#header');*/
                $('#header h2').html(name).css('color','rgb('+r+','+g+','+b+')');
                
        		socket.emit('adduser', name, userdata);
                
                socket.on('killed', function(username) {
                    if(username == name) {
                        sockexit();
                    }
                });
                
                setInterval(function() {
                    testData();
                }, delay);
            });
            
            $('#sendquit').click( function() {
                sockexit();
            });
	    });
        
        function sockexit() {
            socket.disconnect();
            $('#signin').show();
            $('#broadcast').hide();
            $('#header h2').empty();
        }
	
	    function testData() {
            	
            alpha = random(-100,100);
            beta  = random(-100,100);
	        gamma = random(-100,100);
            
	        ax = random(-20,20);
	        ay = random(-20,20);
	        az = random(-20,20);
            
	        ai = random(-20,20)/10;
            
	        arAlpha = random(-360,360);
	        arBeta  = random(-360,360);
	        arGamma = random(-360,360);
			    	
	        var iosjson = {
	                'x': ax,
	                'y': ay,
	                'z': az,
                    'i': ai,
	                'a': alpha,
	                'b': beta,
	                'g': gamma,
	                'ar': arAlpha,
	                'br': arBeta,
	                'gr': arGamma,
	                's': stabilize
	        };
            
			document.getElementById("x").innerHTML = "X: " + ax;
    		document.getElementById("y").innerHTML = "Y: " + ay;
			document.getElementById("z").innerHTML = "Z: " + az;
			document.getElementById("i").innerHTML = "I: " + ai;
			document.getElementById("ar").innerHTML = "arA: " + arAlpha;
			document.getElementById("br").innerHTML = "arB: " + arBeta;
			document.getElementById("gr").innerHTML = "arG: " + arGamma;
			document.getElementById("a").innerHTML = "Alpha: " + alpha;
			document.getElementById("b").innerHTML = "Beta: " + beta;
			document.getElementById("g").innerHTML = "Gamma: " + gamma;
	
	        if (stabilize == 1) {
				stabilize = 0;  // reset stabilization request
			}
            
            socket.emit('sendData', iosjson );
	    }
        
        function random (min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
	</script>

	<!--[if IE]><script language="javascript" type="text/javascript" src="./_js/excanvas.js"></script><![endif]-->
	</head>
<body>
    <div id="header">
      <h1>Collide-TEST.</h1>
      <h2></h2>
    </div>
    <div id="signin">
        <input id="name" />
        <input id="sendname" type="button"  value="name" />
    </div>
    <div id="broadcast">
      <div class="box" id="accel"> <span class="head">Accelerometer</span> <span id="x"></span> <span id="y"></span> <span id="z"></span> <span id="i"></span> <span id="ar"></span> <span id="br"></span> <span id="gr"></span> </div>
      <div class="box" id="gyro"> <span class="head">Gyroscope</span> <span id="a"></span> <span id="b"></span> <span id="g"></span> </div>
      <div class="clear"></div>
      <input id="sendquit" type="button"  value="quit" />
        <canvas id="run" style="position:absolute">
        <script id="sketch" type="application/processing">
            var top = document.getElementById('header').offsetHeight;
            var cnvW = window.innerWidth;
            var cnvH = window.innerHeight - top;
            document.getElementById('run').style.top = top;
            
            console.log(top+', cnvW: '+cnvW+', cnvH: '+cnvH);
            float radius = 50.0;
            color blobby = color(r,g,b);
            void setup(){
                size(cnvW, cnvH);
                strokeWeight( 10 );
            }
            void draw(){
              radius = radius + sin( frameCount / 4 );
              background(0);
              fill(blobby);
              stroke(255);
              ellipse( width / 2, width / 2, radius, radius );                  
            }
        </script>
        	<p>Your browser does not support the canvas tag.</p>
        </canvas>
        <noscript>
        	<p>JavaScript is required to view the contents of this page.</p>
        </noscript>
    </div>
</body>
</html>
